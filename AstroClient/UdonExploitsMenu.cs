using AstroClient.ConsoleUtils;
using RubyButtonAPI;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using UnhollowerBaseLib;
using VRC.Udon;
using VRC.Udon.Common.Interfaces;

namespace AstroClient
{
    public static class UdonExploitsMenu
    {

        public static void InitButtons(QMNestedButton menu, float x, float y, bool btnHalf)
        {

            var submenu = new QMNestedButton(menu, x, y, "Udon Exploits", "Run Udon Events globally", null, null, null, null, btnHalf);
            var MainScroll = new QMScroll(new QMNestedButton(submenu, -5f, -5f, "", ""));
            var subscroll = new QMScroll(submenu);
            new QMSingleButton(submenu, 0, -1, "Refresh", delegate
            {
                MainScroll.Refresh();
                subscroll.Refresh();
            }, "", null, null, true);
            subscroll.SetAction(delegate
            {
                foreach (var action in UnityEngine.Object.FindObjectsOfType<UdonBehaviour>())
                {
                    if (WorldUtils.GetWorldID() == "wrld_858dfdfc-1b48-4e1e-8a43-f0edc611e5fe" || WorldUtils.GetWorldID() == "wrld_dd036610-a246-4f52-bf01-9d7cea3405d7")
                    {
                        if (action.gameObject.name == "Game Logic")
                        {
                            var tmp = new QMSingleButton(submenu, 0f, 0f, action.gameObject.name, delegate
                            {
                                MainScroll.SetAction(delegate
                                {
                                    foreach (var subaction in action._eventTable)
                                    {
                                        MainScroll.Add(new QMSingleButton(MainScroll.BaseMenu, 0f, 0f, subaction.Key, delegate
                                        {
                                            action.SendCustomNetworkEvent(NetworkEventTarget.All, subaction.Key);
                                        }, (action.gameObject)?.ToString() + " Execute " + subaction.Key));
                                    }
                                });
                                MainScroll.BaseMenu.getMainButton().getGameObject().GetComponent<UnityEngine.UI.Button>()
                                    .onClick.Invoke();
                            }, action.interactText);
                            subscroll.Add(tmp, 0, true, 1f, 0f);
                            continue;
                        }
                    }

                    subscroll.Add(new QMSingleButton(submenu, 0f, 0f, action.gameObject.name, delegate
                    {
                        MainScroll.SetAction(delegate
                        {
                            foreach (var subaction in action._eventTable)
                            {
                                MainScroll.Add(new QMSingleButton(MainScroll.BaseMenu, 0f, 0f, subaction.Key, delegate
                                {
                                    action.SendCustomNetworkEvent(NetworkEventTarget.All, subaction.Key);
                                }, (action.gameObject)?.ToString() + " Run " + subaction.Key));
                            }
                        });
                        MainScroll.BaseMenu.getMainButton().getGameObject().GetComponent<UnityEngine.UI.Button>()
                            .onClick.Invoke();
                    }, action.interactText));
                }
            });
        }

        public static int RemoveSyncVotedForText(string key)
        {
            var removedtext = key.ToLower().Replace("syncvotedfor", string.Empty).Replace(" ", string.Empty);
            int.TryParse(removedtext, out var value);
            return value;
        }


        public static void InitMurder4ExploitBtn(QMNestedButton menu, float x, float y, bool btnHalf)
        {

            var submenu = new QMNestedButton(menu, x, y, "Murder 4 Exploits", "Run Udon Events globally", null, null, null, null, btnHalf);
            var MainScroll = new QMScroll(new QMNestedButton(submenu, -5f, -5f, "", ""));
            var subscroll = new QMScroll(submenu);
            new QMSingleButton(submenu, 0, -1, "Refresh", delegate
            {
                MainScroll.Refresh();
                subscroll.Refresh();
            }, "", null, null, true);
            subscroll.SetAction(delegate
            {

                foreach (var action in UnityEngine.Object.FindObjectsOfType<UdonBehaviour>())
                {
                    if (action.gameObject.name == "Game Logic")
                    {
                        var tmp = new QMSingleButton(submenu, 0f, 0f, action.gameObject.name, delegate
                        {
                            MainScroll.SetAction(delegate
                            {
                                foreach (var subaction in action._eventTable)
                                {
                                    MainScroll.Add(new QMSingleButton(MainScroll.BaseMenu, 0f, 0f, subaction.Key, delegate
                                    {
                                        action.SendCustomNetworkEvent(NetworkEventTarget.All, subaction.Key);
                                    }, (action.gameObject)?.ToString() + " Execute " + subaction.Key));
                                }
                            });
                            MainScroll.BaseMenu.getMainButton().getGameObject().GetComponent<UnityEngine.UI.Button>()
                                .onClick.Invoke();
                        }, action.interactText);
                        subscroll.Add(tmp, 0, true, 1f, 0f);
                        break;
                    }
                }
                if (JarRoleController.ShowHiddenNodes)
                {
                    foreach (var Links in JarRoleController.JarRoleLinks)
                    {

                        foreach (var action in Links.Node.GetComponentsInChildren<UdonBehaviour>())
                        {
                            if (action != null)
                            {
                                subscroll.Add(new QMSingleButton(submenu, 0f, 0f, action.gameObject.name, delegate
                                {
                                    MainScroll.SetAction(delegate
                                    {
                                        foreach (var subaction in action._eventTable)
                                        {
                                            MainScroll.Add(new QMSingleButton(MainScroll.BaseMenu, 0f, 0f, subaction.Key, delegate
                                            {
                                                action.SendCustomNetworkEvent(NetworkEventTarget.All, subaction.Key);
                                            }, (action.gameObject)?.ToString() + " Run " + subaction.Key));
                                        }
                                    });
                                    MainScroll.BaseMenu.getMainButton().getGameObject().GetComponent<UnityEngine.UI.Button>()
                                        .onClick.Invoke();
                                }, action.interactText));
                            }
                        }
                    }
                }
                else
                {
                    {
                        foreach (var Links in JarRoleController.JarRoleLinks)
                        {
                            if (!Links.Node.name.ToLower().Contains("player node") && !Links.Node.name.ToLower().Contains("unassigned node"))
                            {
                                foreach (var action in Links.Node.GetComponentsInChildren<UdonBehaviour>())
                                {
                                    if (action != null)
                                    {
                                        if (!action.gameObject.name.ToLower().Contains("player node") && !action.gameObject.name.ToLower().Contains("unassigned node"))
                                        {
                                            subscroll.Add(new QMSingleButton(submenu, 0f, 0f, action.gameObject.name, delegate
                                            {
                                                MainScroll.SetAction(delegate
                                                {
                                                    foreach (var subaction in action._eventTable)
                                                    {
                                                        MainScroll.Add(new QMSingleButton(MainScroll.BaseMenu, 0f, 0f, subaction.Key, delegate
                                                         {
                                                             action.SendCustomNetworkEvent(NetworkEventTarget.All, subaction.Key);
                                                         }, (action.gameObject)?.ToString() + " Run " + subaction.Key));
                                                    }
                                                });
                                                MainScroll.BaseMenu.getMainButton().getGameObject().GetComponent<UnityEngine.UI.Button>()
                                                    .onClick.Invoke();
                                            }, action.interactText));
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            });
        }


        public static void InitAmongUSExploitBtn(QMNestedButton menu, float x, float y, bool btnHalf)
        {

            var submenu = new QMNestedButton(menu, x, y, "Among Us Exploits", "Run Udon Events globally", null, null, null, null, btnHalf);

            var MainScroll = new QMScroll(new QMNestedButton(submenu, -5f, -5f, "", ""));
            var subscroll = new QMScroll(submenu);
            new QMSingleButton(submenu, 0, -1, "Refresh", delegate
            {
                MainScroll.Refresh();
                subscroll.Refresh();
            }, "", null, null, true);
            subscroll.SetAction(delegate
            {

                foreach (var action in UnityEngine.Object.FindObjectsOfType<UdonBehaviour>())
                {
                    if (action.gameObject.name == "Game Logic")
                    {
                        var tmp = new QMSingleButton(submenu, 0f, 0f, action.gameObject.name, delegate
                        {
                            MainScroll.SetAction(delegate
                            {
                                foreach (var subaction in action._eventTable)
                                {
                                    MainScroll.Add(new QMSingleButton(MainScroll.BaseMenu, 0f, 0f, subaction.Key, delegate
                                    {
                                        action.SendCustomNetworkEvent(NetworkEventTarget.All, subaction.Key);
                                    }, (action.gameObject)?.ToString() + " Execute " + subaction.Key));
                                }
                            });
                            MainScroll.BaseMenu.getMainButton().getGameObject().GetComponent<UnityEngine.UI.Button>()
                                .onClick.Invoke();
                        }, action.interactText);
                        subscroll.Add(tmp, 0, true, 1f, 0f);
                        break;
                    }
                }

                if (JarRoleController.ShowHiddenNodes)
                {
                    foreach (var Links in JarRoleController.JarRoleLinks)
                    {
                        foreach (var action in Links.Node.GetComponentsInChildren<UdonBehaviour>())
                        {
                            if (action != null)
                            {
                                subscroll.Add(new QMSingleButton(submenu, 0f, 0f, action.gameObject.name, delegate
                                {
                                    MainScroll.SetAction(delegate
                                    {
                                        foreach (var subaction in action._eventTable)
                                        {

                                            // RENAME SyncVotedFor With Node Name.
                                            if (subaction.Key.ToLower().StartsWith("syncvotedfor"))
                                            {
                                                var GetNodeLink = JarRoleController.GetLinkedNode(RemoveSyncVotedForText(subaction.key));
                                                if (GetNodeLink != null)
                                                {
                                                    MainScroll.Add(new QMSingleButton(MainScroll.BaseMenu, 0f, 0f, "Voted For : \n" + GetNodeLink.Node.name, delegate
                                                    {

                                                        action.SendCustomNetworkEvent(NetworkEventTarget.All, subaction.Key);
                                                    }, (action.gameObject)?.ToString() + " Run " + "Voted For : \n" + GetNodeLink.Node.name));
                                                }
                                                else // IGNORE IF CHECK FAILS AND ADD IT ANYWAYS WITH ORIGINAL NAME
                                                {
                                                    MainScroll.Add(new QMSingleButton(MainScroll.BaseMenu, 0f, 0f, subaction.Key, delegate
                                                    {
                                                        action.SendCustomNetworkEvent(NetworkEventTarget.All, subaction.Key);
                                                    }, (action.gameObject)?.ToString() + " Run " + subaction.Key));
                                                }
                                            }
                                            else
                                            {
                                                MainScroll.Add(new QMSingleButton(MainScroll.BaseMenu, 0f, 0f, subaction.Key, delegate
                                                {
                                                    action.SendCustomNetworkEvent(NetworkEventTarget.All, subaction.Key);
                                                }, (action.gameObject)?.ToString() + " Run " + subaction.Key));
                                            }
                                        }
                                    });
                                    MainScroll.BaseMenu.getMainButton().getGameObject().GetComponent<UnityEngine.UI.Button>()
                                        .onClick.Invoke();
                                }, action.interactText));
                            }
                        }
                    }
                }
                else
                {
                    foreach (var Links in JarRoleController.JarRoleLinks)
                    {
                        if (!Links.Node.name.ToLower().Contains("player node") && !Links.Node.name.ToLower().Contains("unassigned node"))
                        {
                            foreach (var action in Links.Node.GetComponentsInChildren<UdonBehaviour>())
                            {
                                if (action != null)
                                {
                                    if (!action.gameObject.name.ToLower().Contains("player node") && !action.gameObject.name.ToLower().Contains("unassigned node"))
                                    {
                                        subscroll.Add(new QMSingleButton(submenu, 0f, 0f, action.gameObject.name, delegate
                                    {
                                        MainScroll.SetAction(delegate
                                        {
                                            foreach (var subaction in action._eventTable)
                                            {
                                                // RENAME SyncVotedFor With Node Name.
                                                if (subaction.Key.ToLower().StartsWith("syncvotedfor"))
                                                {
                                                    var GetNodeLink = JarRoleController.GetLinkedNode(RemoveSyncVotedForText(subaction.key));
                                                    if (GetNodeLink != null)
                                                    {
                                                        if (!GetNodeLink.Node.name.ToLower().Contains("unassigned node") && !GetNodeLink.Node.name.ToLower().Contains("player node"))
                                                        {
                                                            MainScroll.Add(new QMSingleButton(MainScroll.BaseMenu, 0f, 0f, "Voted For : \n" + GetNodeLink.Node.name, delegate
                                                                {
                                                                    action.SendCustomNetworkEvent(NetworkEventTarget.All, subaction.Key);
                                                                }, (action.gameObject)?.ToString() + " Run " + "Voted For : \n" + GetNodeLink.Node.name));
                                                        }
                                                    }
                                                }
                                                else
                                                {

                                                    MainScroll.Add(new QMSingleButton(MainScroll.BaseMenu, 0f, 0f, subaction.Key, delegate
                                                        {
                                                            action.SendCustomNetworkEvent(NetworkEventTarget.All, subaction.Key);
                                                        }, (action.gameObject)?.ToString() + " Run " + subaction.Key));
                                                }
                                            }
                                        });
                                        MainScroll.BaseMenu.getMainButton().getGameObject().GetComponent<UnityEngine.UI.Button>()
                                            .onClick.Invoke();
                                    }, action.interactText));
                                    }
                                }
                            }
                        }
                    }
                }

            });
        }
    }
}


