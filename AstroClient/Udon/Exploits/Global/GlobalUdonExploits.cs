using RubyButtonAPI;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using VRC.Udon;
using VRC.Udon.Common.Interfaces;

namespace AstroClient.UdonExploits
{
    public static class GlobalUdonExploits
    {

        public static void InitButtons(QMNestedButton menu, float x, float y, bool btnHalf)
        {

            var submenu = new QMNestedButton(menu, x, y, "Udon Exploits", "Run Udon Events globally", null, null, null, null, btnHalf);
            var whytfisthishere = new QMNestedButton(submenu, -5f, -5f, "", "");
            whytfisthishere.getMainButton().setActive(false);
            var MainScroll = new QMScroll(whytfisthishere);
            var subscroll = new QMScroll(submenu);
            new QMSingleButton(submenu, 0, -1, "Refresh", delegate
            {
                MainScroll.Refresh();
                subscroll.Refresh();
            }, "", null, null, true);
            subscroll.SetAction(delegate
            {
                foreach (var action in UnityEngine.Object.FindObjectsOfType<UdonBehaviour>())
                {
                    subscroll.Add(new QMSingleButton(submenu, 0f, 0f, action.gameObject.name, delegate
                    {
                        MainScroll.SetAction(delegate
                        {
                            foreach (var subaction in action._eventTable)
                            {
                                MainScroll.Add(new QMSingleButton(MainScroll.BaseMenu, 0f, 0f, subaction.Key, delegate
                                {
                                    action.SendCustomNetworkEvent(NetworkEventTarget.All, subaction.Key);
                                }, (action.gameObject)?.ToString() + " Run " + subaction.Key));
                            }
                        });
                        MainScroll.BaseMenu.getMainButton().getGameObject().GetComponent<UnityEngine.UI.Button>()
                            .onClick.Invoke();
                    }, action.interactText));
                }
            });
        }




    }
}
